#!/bin/bash /etc/rc.common

START=99
STOP=99

status=$(pidof k3screenctrl)

for i in /lib/k3screenctrl/*; do
  [ -f $i -a ! -x $i ]&&chmod +x $i
  chmod +x $i
done

for i in /etc/init.d/k3screenctrl /usr/bin/k3screenctrl; do
  [ -f $i -a ! -x $i ]&&chmod +x $i
  chmod +x $i
done

stop()
{
  [ "${status:-0}" != "$$" ]&&killall k3screenctrl
  rm -f /tmp/device_icon.log
  rm -f /tmp/os_version
  rm -f /tmp/weather.json
  rm -rf /tmp/speed
}

start()
{
  delay=$(uci get k3screenctrl.@general[0].refresh_time)
  max=$(uci get k3screenctrl.@general[0].screen_time)
  [ "${status:-0}" = "$$" ]&&k3screenctrl -d ${delay#:-1} -m ${max#:-15} &
}

restart()
{
  stop
  start
}

